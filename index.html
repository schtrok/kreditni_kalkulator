<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Stambeni kredit kalkulator ‚Äì ratu vs. rok</title>
  <style>
    :root {
      --bg:#0f172a;
      --surface:#1e293b;
      --surface-alt:#334155;
      --text:#f8fafc;
      --muted:#94a3b8;
      --accent:#38bdf8;
      --border:rgba(148,163,184,.25);
      --border-soft:rgba(148,163,184,.12);
      --row-accent:rgba(56,189,248,.07);
      --radius-lg:1rem;
      --radius-md:.75rem;
      --radius-sm:.5rem;
    }

    * {
      box-sizing:border-box;
      -webkit-font-smoothing:antialiased;
    }

    body {
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:2rem;
    }

    .app {
      width:100%;
      max-width:1300px;
      display:flex;
      flex-direction:column;
      gap:1.5rem;
    }

    header .title {
      font-size:1.25rem;
      font-weight:600;
      color:var(--text);
      display:flex;
      align-items:center;
      gap:.5rem;
      flex-wrap:wrap;
    }

    header .badge {
      background:var(--row-accent);
      color:var(--accent);
      border:1px solid var(--accent);
      border-radius:999px;
      font-size:.7rem;
      line-height:1;
      font-weight:500;
      padding:.4rem .6rem;
    }

    header .tagline {
      font-size:.9rem;
      color:var(--muted);
      margin-top:.25rem;
      max-width:800px;
      line-height:1.4;
    }

    .card {
      background:var(--surface);
      border:1px solid var(--border-soft);
      border-radius:var(--radius-lg);
      box-shadow:0 30px 80px rgba(0,0,0,.7);
      padding:1.25rem 1.25rem 1rem;
    }

    .section-head {
      display:flex;
      flex-wrap:wrap;
      align-items:baseline;
      justify-content:space-between;
      gap:.5rem;
      margin-bottom:1rem;
    }

    .section-head h2 {
      margin:0;
      font-size:1rem;
      font-weight:600;
      color:var(--text);
      display:flex;
      align-items:center;
      gap:.5rem;
    }

    .section-head h2 .dot {
      width:.5rem;
      height:.5rem;
      background:var(--accent);
      border-radius:999px;
      box-shadow:0 0 12px var(--accent);
    }

    .section-head .sub {
      font-size:.8rem;
      color:var(--muted);
      line-height:1.3;
    }

    /* Tabs */
    .tabs {
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      margin-bottom:.75rem;
    }

    .tab-button {
      background:var(--surface-alt);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:var(--radius-md);
      font-size:.8rem;
      font-weight:500;
      line-height:1.2;
      padding:.5rem .75rem;
      cursor:pointer;
      box-shadow:0 10px 20px rgba(0,0,0,.5);
      transition:filter .15s, box-shadow .15s;
    }

    .tab-button:hover {
      filter:brightness(1.05);
      box-shadow:0 20px 40px rgba(0,0,0,.6);
    }

    .tab-button.active {
      background:var(--accent);
      color:#002233;
      border:1px solid var(--accent);
      box-shadow:0 20px 40px rgba(56,189,248,.4);
    }

    .model-label {
      font-size:.75rem;
      font-weight:600;
      color:var(--accent);
      background:var(--row-accent);
      border:1px solid rgba(56,189,248,.4);
      border-radius:var(--radius-md);
      padding:.5rem .75rem;
      line-height:1.3;
      max-width:fit-content;
      box-shadow:0 20px 40px rgba(0,0,0,.6);
      margin-bottom:.75rem;
    }

    /* FORM  */
    form#calcForm {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(min(240px,100%),1fr));
      gap:1rem 1.25rem;
    }

    .field {
      display:flex;
      flex-direction:column;
      gap:.4rem;
    }

    .field label {
      font-size:.8rem;
      font-weight:500;
      color:var(--text);
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      line-height:1.3;
    }

    .field label span.tip {
      font-weight:400;
      color:var(--muted);
      font-size:.7rem;
    }

    .field input,
    .field select {
      -webkit-appearance:none;
      appearance:none;
      width:100%;
      background:var(--bg);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:var(--radius-md);
      padding:.75rem .8rem;
      font-size:.9rem;
      line-height:1.2;
      outline:none;
      box-shadow:0 0 0 2px transparent;
      transition:border-color .15s, box-shadow .15s;
    }

    .field input:focus,
    .field select:focus {
      border-color:var(--accent);
      box-shadow:0 0 0 2px rgba(56,189,248,.4);
    }

    .calc-col-span {
      grid-column:1 / -1;
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:flex-start;
      gap:1rem;
    }

    .calc-button {
      cursor:pointer;
      border:0;
      border-radius:var(--radius-md);
      background:var(--accent);
      color:#002233;
      font-weight:600;
      font-size:.9rem;
      line-height:1.2;
      padding:.8rem 1rem;
      min-width:140px;
      box-shadow:0 20px 40px rgba(56,189,248,.4);
      transition:box-shadow .15s, filter .15s;
    }

    .calc-button:hover {
      filter:brightness(1.05);
      box-shadow:0 30px 60px rgba(56,189,248,.5);
    }

    .disclaimer {
      margin-top:1rem;
      font-size:.7rem;
      line-height:1.4;
      color:var(--muted);
      max-width:900px;
    }

    /* SUMMARY  */
    .summary-wrapper {
      display:flex;
      flex-direction:column;
      gap:1rem;
    }

    .warning {
      background:rgba(251,191,36,.07);
      color:#facc15;
      border:1px solid rgba(250,204,21,.3);
      border-radius:var(--radius-md);
      padding:.75rem 1rem;
      font-size:.8rem;
      line-height:1.4;
      font-weight:500;
    }

    .summary-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(min(200px,100%),1fr));
      gap:1rem;
    }

    .summary-item {
      background:var(--surface-alt);
      border:1px solid var(--border-soft);
      border-radius:var(--radius-md);
      padding:1rem 1rem .9rem;
      min-height:110px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      box-shadow:0 20px 40px rgba(0,0,0,.6);
    }

    .summary-label {
      font-size:.75rem;
      font-weight:500;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      line-height:1.3;
      margin-bottom:.5rem;
    }

    .summary-value {
      font-size:1.1rem;
      font-weight:600;
      color:var(--text);
      line-height:1.3;
      word-break:break-word;
    }

    .summary-hint {
      font-size:.7rem;
      font-weight:400;
      color:var(--muted);
      line-height:1.3;
      margin-top:.4rem;
    }

    /* TABLE */
    .table-wrapper {
      border:1px solid var(--border-soft);
      border-radius:var(--radius-md);
      box-shadow:0 30px 60px rgba(0,0,0,.7);
      background:var(--surface-alt);
    }

    table {
      border-collapse:collapse;
      width:100%;
      font-size:.8rem;
      min-width:800px;
      color:var(--text);
    }

    thead {
      position:sticky;
      top:0;
      z-index:10;
      background:var(--surface-alt);
      box-shadow:0 2px 0 0 var(--border-soft);
    }

    th {
      text-align:right;
      font-weight:500;
      color:var(--muted);
      padding:.6rem .75rem;
      line-height:1.2;
      white-space:nowrap;
      background:var(--surface-alt);
    }

    th.col-left,
    td.col-left {
      text-align:left;
    }

    tbody tr {
      border-bottom:1px solid var(--border-soft);
    }

    tbody tr.lump-row {
      background:var(--row-accent);
    }

    td {
      text-align:right;
      padding:.6rem .75rem;
      line-height:1.2;
      color:var(--text);
      vertical-align:top;
    }

    td.col-left {
      font-weight:500;
      color:var(--text);
    }

    @media (max-width:600px){
      header .title {font-size:1.05rem;}
      .tagline {font-size:.8rem;}
    }
  </style>
</head>
<body>
  <div class="app">

    <header>
      <div class="title">
        <span>üè† Stambeni kredit kalkulator</span>
        <span class="badge">eksperimentalno</span>
      </div>
      <div class="tagline">
        Usporedi dvije strategije nakon godi≈°nje prijevremene uplate: <b>smanji ratu</b> vs. <b>skrati rok</b>.
        Uraƒçunato je i "mjeseƒçno odvajanje".
      </div>
    </header>

    <!-- INPUT CARD -->
    <section class="card">
      <div class="section-head">
        <h2><span class="dot"></span> Ulazni parametri</h2>
        <div class="sub">Unesi svoj scenarij i stisni "Izraƒçunaj plan".</div>
      </div>

      <form id="calcForm">
        <div class="field">
          <label for="principal">
            Iznos kredita
            <span class="tip">‚Ç¨</span>
          </label>
          <input id="principal" type="number" min="0" step="1" required value="180000" />
        </div>

        <div class="field">
          <label for="rate">
            Godi≈°nja kamatna stopa
            <span class="tip">% fiksno</span>
          </label>
          <input id="rate" type="number" min="0" step="0.01" required value="2.85" />
        </div>

        <div class="field">
          <label for="years">
            Rok otplate (plan)
            <span class="tip">godina</span>
          </label>
          <input id="years" type="number" min="1" step="0.5" required value="30" />
        </div>

        <div class="field">
          <label for="type">
            Vrsta otplate
            <span class="tip">anuitet ili fiksna glavnica</span>
          </label>
          <select id="type">
            <option value="anuitet" selected>Anuitet (fiksna mjeseƒçna uplata)</option>
            <option value="glavnica">Fiksna glavnica + kamata (rata pada kroz vrijeme)</option>
          </select>
        </div>

        <div class="field">
          <label for="allocation">
            Mjeseƒçno odvajanje
            <span class="tip">‚Ç¨ koje si spreman izdvojiti mjeseƒçno (rata + ≈°tednja)</span>
          </label>
          <input id="allocation" type="number" min="0" step="1" required value="1500" />
        </div>

        <div class="calc-col-span">
          <button class="calc-button" type="submit">Izraƒçunaj plan</button>
        </div>
      </form>

      <div class="disclaimer">
        Pretpostavke:
        (1) Svaki mjesec plaƒáa≈° redovnu ratu kredita.
        (2) Ako je "mjeseƒçno odvajanje" veƒáe od rate, razlika se gomila kao ≈°tednja.
        (3) Svakih 12 mjeseci cijela ≈°tednja se uplati u glavnicu (prijevremena otplata).
        Nakon toga postoje 2 opcije:
        - "Smanji ratu": banka snizi buduƒáe rate, rok ostaje ~isti.
        - "Skrati rok": rata ostaje ista, ali se rok skraƒáuje.
        Ovo je pojednostavljen model, banke mogu raditi drugaƒçije.
      </div>
    </section>

    <!-- SUMMARY CARD -->
    <section class="card">
      <div class="section-head">
        <h2><span class="dot"></span> Sa≈æetak scenarija</h2>
        <div class="sub">Odaberi model ispod pa gledaj trajanje, kamate i iznose prijevremene uplate.</div>
      </div>

      <div class="tabs" id="tabs">
        <button class="tab-button active" data-tab="ratu">üìâ Smanji ratu</button>
        <button class="tab-button" data-tab="rok">‚è≥ Skrati rok</button>
      </div>

      <div id="summaryBox" class="summary-wrapper">
        <div style="font-size:.8rem;color:var(--muted);">
          Jo≈° nema podataka. Ispuni formu iznad i klikni "Izraƒçunaj plan".
        </div>
      </div>
    </section>

    <!-- TABLE CARD -->
    <section class="card">
      <div class="section-head">
        <h2><span class="dot"></span> Detaljni otplatni plan (mjeseƒçno)</h2>
        <div class="sub">
          <span class="activeModelLabel">Model: smanji ratu</span><br/>
          Svaki red = 1 mjesec. Redovi s plavom pozadinom su mjeseci kad se radi godi≈°nja prijevremena uplata glavnice.
        </div>
      </div>

      <div class="table-wrapper">
        <table id="scheduleTable">
          <thead>
            <tr>
              <th class="col-left">Mjesec</th>
              <th>Redovna rata</th>
              <th>Kamata dio</th>
              <th>Otplata glavnice</th>
              <th>Godi≈°nja uplata na glavnicu</th>
              <th>U≈°teƒëevina (kraj mj.)</th>
              <th>Preostala glavnica</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="col-left" colspan="7" style="text-align:center;color:var(--muted);padding:2rem .75rem;">
                Nema podataka jo≈°. Nakon izraƒçuna ovdje ƒáe se pojaviti plan po mjesecima.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

  </div>

  <script>
    // ---------------------------------
    // Globalni state
    // ---------------------------------
    let activeTab = "ratu"; // "ratu" (smanji ratu) ili "rok" (skrati rok)
    let lastResultRatu = null;
    let lastResultRok = null;
    let allocationCurrent = 0;

    // -----------------------
    // Helper format funkcije
    // -----------------------
    function formatCurrency(n){
      if (isNaN(n)) return "-";
      return n.toLocaleString("hr-HR", {
        style:"currency",
        currency:"EUR",
        minimumFractionDigits:2,
        maximumFractionDigits:2
      });
    }

    function humanDuration(months){
      const y = Math.floor(months/12);
      const m = months % 12;
      return `${y} god. ${m} mj. (${months} mj.)`;
    }

    // ---------------------------------------
    // Matematika anuiteta
    // ---------------------------------------
    function annuityPayment(balance, r, n){
      if(n <= 0) return balance;
      if(r === 0){
        return balance / n;
      } else {
        const powv = Math.pow(1+r, n);
        return balance * (r * powv)/(powv - 1);
      }
    }

    // ---------------------------------------
    // Model 1: SMANJI RATU
    // - nakon godi≈°nje prijevremene uplate banka reamortizira kredit
    //   tako da rok (krajnji datum) ostane isti, a rata padne
    // ---------------------------------------
    function generateScheduleReducePayment(P, annualRate, years, loanType, allocation){
      const r = (annualRate/100)/12; // mjeseƒçna kamata
      const N_total = Math.round(years*12);

      let remaining = P;
      let savings = 0;
      let rows = [];
      let totalInterest = 0;
      let totalLump = 0;

      let monthIndex = 1;
      let guard = 0;

      // stanje rate / glavnice po segmentima
      let remainingTerm = N_total;
      let currentPayment = 0;        // za anuitet
      let basePrincipalPerMonth = 0; // za "glavnica"

      if(loanType === "anuitet"){
        currentPayment = annuityPayment(remaining, r, remainingTerm);
      } else {
        basePrincipalPerMonth = P / N_total;
      }

      while(remaining > 1e-8 && guard < 10000){
        guard++;

        let paymentThisMonth, interest, principalPay;
        let lump = 0;

        if(loanType === "anuitet"){
          interest = remaining * r;
          principalPay = currentPayment - interest;
          if(principalPay > remaining){
            principalPay = remaining;
            paymentThisMonth = principalPay + interest;
          } else {
            paymentThisMonth = currentPayment;
          }
        } else {
          // fiksna glavnica po segmentu
          principalPay = Math.min(basePrincipalPerMonth, remaining);
          interest = remaining * r;
          paymentThisMonth = principalPay + interest;
        }

        // ≈°tednja iz "mjeseƒçnog odvajanja"
        const saveAdd = Math.max(allocation - paymentThisMonth, 0);
        savings += saveAdd;

        // redovna uplata
        remaining -= principalPay;
        if(remaining < 1e-8){ remaining = 0; }

        // godi≈°nja prijevremena uplata
        if(monthIndex % 12 === 0 && remaining > 0){
          lump = Math.min(savings, remaining);
          remaining -= lump;
          savings -= lump;
          totalLump += lump;
          if(remaining < 1e-8){ remaining = 0; }

          // re-amortizacija nakon prijevremene uplate:
          // cilj: SMANJITI RATU, zadr≈æati krajnji rok
          remainingTerm = N_total - monthIndex;
          if(remainingTerm < 1){ remainingTerm = 1; }

          if(remaining > 0){
            if(loanType === "anuitet"){
              currentPayment = annuityPayment(remaining, r, remainingTerm);
            } else {
              basePrincipalPerMonth = remaining / remainingTerm;
            }
          }
        }

        totalInterest += interest;

        rows.push({
          month: monthIndex,
          payment: paymentThisMonth,
          interest: interest,
          principal: principalPay,
          lump: lump,
          savings: savings,
          remaining: remaining
        });

        if(remaining <= 0){
          break;
        }

        monthIndex++;
      }

      return {
        rows,
        totalInterest,
        totalLump,
        monthsToFinish: monthIndex
      };
    }

    // ---------------------------------------
    // Model 2: SKRATI ROK
    // - nakon godi≈°nje prijevremene uplate rata ostaje ista,
    //   ali se rok skraƒáuje (otplati≈° ranije)
    // ---------------------------------------
    function generateScheduleShortenTerm(P, annualRate, years, loanType, allocation){
      const r = (annualRate/100)/12;
      const N_total = Math.round(years*12);

      let remaining = P;
      let savings = 0;
      let rows = [];
      let totalInterest = 0;
      let totalLump = 0;

      let monthIndex = 1;
      let guard = 0;

      // fiksna rata / fiksni dio glavnice definirani na poƒçetku
      let fixedPayment = 0;              // za anuitet
      let basePrincipalFixed = P / N_total; // za glavnica

      if(loanType === "anuitet"){
        fixedPayment = annuityPayment(remaining, r, N_total);
      }

      while(remaining > 1e-8 && guard < 10000){
        guard++;

        let paymentThisMonth, interest, principalPay;
        let lump = 0;

        if(loanType === "anuitet"){
          interest = remaining * r;
          principalPay = fixedPayment - interest;
          if(principalPay > remaining){
            principalPay = remaining;
            paymentThisMonth = principalPay + interest; // zadnji mjesec manja rata
          } else {
            paymentThisMonth = fixedPayment;
          }
        } else {
          // fiksni dio glavnice baziran na poƒçetnom planu
          principalPay = Math.min(basePrincipalFixed, remaining);
          interest = remaining * r;
          paymentThisMonth = principalPay + interest;
        }

        // ≈°tednja
        const saveAdd = Math.max(allocation - paymentThisMonth, 0);
        savings += saveAdd;

        // redovna uplata
        remaining -= principalPay;
        if(remaining < 1e-8){ remaining = 0; }

        // godi≈°nja lump sum uplata, ali NE mijenjamo buduƒáu ratu
        if(monthIndex % 12 === 0 && remaining > 0){
          lump = Math.min(savings, remaining);
          remaining -= lump;
          savings -= lump;
          totalLump += lump;
          if(remaining < 1e-8){ remaining = 0; }
        }

        totalInterest += interest;

        rows.push({
          month: monthIndex,
          payment: paymentThisMonth,
          interest: interest,
          principal: principalPay,
          lump: lump,
          savings: savings,
          remaining: remaining
        });

        if(remaining <= 0){
          break;
        }

        monthIndex++;
      }

      return {
        rows,
        totalInterest,
        totalLump,
        monthsToFinish: monthIndex
      };
    }

    // -----------------------
    // Render sa≈æetka
    // -----------------------
    function renderSummary(result, allocation, mode){
      const box = document.getElementById("summaryBox");

      if(!result || !result.rows || result.rows.length === 0){
        box.innerHTML = `<div style="font-size:.8rem;color:var(--muted);">
          Jo≈° nema podataka. Ispuni formu iznad i klikni "Izraƒçunaj plan".
        </div>`;
        return;
      }

      const firstPayment = result.rows[0].payment || 0;
      const warningNeeded = result.rows.some(r => r.payment > allocation);

      const months = result.monthsToFinish;
      const durationTxt = humanDuration(months);

      const totalInterest = result.totalInterest;
      const totalLump = result.totalLump;

      // zadnji red
      const lastRow = result.rows[result.rows.length-1];
      const endSavings = lastRow ? lastRow.savings : 0;

      const warnHtml = warningNeeded
        ? `<div class="warning">
            ‚ö† U nekim mjesecima rata je veƒáa od zadanog "mjeseƒçnog odvajanja".
            Kalkulator i dalje pretpostavlja da ratu uspijeva≈° platiti,
            ali tada nema dodatne ≈°tednje taj mjesec.
          </div>`
        : "";

      const modelText = mode === "ratu"
        ? "üìâ Model: smanji ratu (banka nakon godi≈°nje prijevremene uplate spusti buduƒáe rate, krajnji rok ostaje ~isti)"
        : "‚è≥ Model: skrati rok (banka ostavlja istu ratu, pa se kredit zatvara ranije)";

      const disclaimerMain = mode === "ratu"
        ? "Banka nakon svake godi≈°nje prijevremene uplate smanjuje iduƒáe rate tako da krajnji rok otplate nominalno ostane isti."
        : "Banka nakon svake godi≈°nje prijevremene uplate NE spu≈°ta ratu nego ostavlja istu mjeseƒçnu ratu, pa se kredit otplati ranije.";

      box.innerHTML = `
        <div class="model-label">${modelText}</div>

        <div class="summary-grid">

          <div class="summary-item">
            <div class="summary-label">
              <span>Efektivno trajanje kredita</span>
            </div>
            <div class="summary-value">${durationTxt}</div>
            <div class="summary-hint">Ukupan broj mjeseci dok saldo ne padne na 0.</div>
          </div>

          <div class="summary-item">
            <div class="summary-label">
              <span>Poƒçetna mjeseƒçna rata</span>
              <span style="color:var(--accent);font-weight:600;">(mjesec 1)</span>
            </div>
            <div class="summary-value">${formatCurrency(firstPayment)}</div>
            <div class="summary-hint">Razlika do "mjeseƒçnog odvajanja" ide u ≈°tednju.</div>
          </div>

          <div class="summary-item">
            <div class="summary-label">
              <span>Ukupno plaƒáena kamata</span>
            </div>
            <div class="summary-value">${formatCurrency(totalInterest)}</div>
            <div class="summary-hint">Zbroj svih mjeseƒçnih kamata do zatvaranja kredita.</div>
          </div>

          <div class="summary-item">
            <div class="summary-label">
              <span>Prijevremene uplate</span>
              <span style="color:var(--accent);font-weight:600;">(1√ó godi≈°nje)</span>
            </div>
            <div class="summary-value">${formatCurrency(totalLump)}</div>
            <div class="summary-hint">Ukupan iznos ≈°tednje koja je svake godine spu≈°tala glavnicu.</div>
          </div>

        </div>

        ${warnHtml}

        <div class="disclaimer" style="margin-top:1rem;">
          ${disclaimerMain}<br/><br/>
          Na kraju otplate preostala glavnica ‚âà 0 ‚Ç¨. Ako vidi≈° mali ostatak ≈°tednje (${formatCurrency(endSavings)}),
          znaƒçi da zadnjom godi≈°njom uplatom otplati≈° sve i ostane ti malo neiskori≈°tene ≈°tednje.
        </div>
      `;
    }

    // -----------------------
    // Render tablice (aktivni model)
    // -----------------------
    function renderTable(rows){
      const tbody = document.querySelector("#scheduleTable tbody");

      if(!rows || rows.length === 0){
        tbody.innerHTML = `
          <tr>
            <td class="col-left" colspan="7" style="text-align:center;color:var(--muted);padding:2rem .75rem;">
              Nema podataka jo≈°. Nakon izraƒçuna ovdje ƒáe se pojaviti plan po mjesecima.
            </td>
          </tr>`;
        return;
      }

      let html = "";
      rows.forEach(r => {
        html += `
          <tr class="${r.lump > 0 ? "lump-row" : ""}">
            <td class="col-left">${r.month}</td>
            <td>${formatCurrency(r.payment)}</td>
            <td>${formatCurrency(r.interest)}</td>
            <td>${formatCurrency(r.principal)}</td>
            <td>${r.lump > 0 ? formatCurrency(r.lump) : "-"}</td>
            <td>${formatCurrency(r.savings)}</td>
            <td>${formatCurrency(r.remaining)}</td>
          </tr>
        `;
      });

      tbody.innerHTML = html;
    }

    // -----------------------
    // Render cijelog UI-a za aktivni tab
    // -----------------------
    function renderUI(){
      const res = activeTab === "ratu" ? lastResultRatu : lastResultRok;
      const labelEl = document.querySelector(".activeModelLabel");

      if(!res){
        document.getElementById("summaryBox").innerHTML = `<div style="font-size:.8rem;color:var(--muted);">
          Jo≈° nema podataka. Ispuni formu iznad i klikni "Izraƒçunaj plan".
        </div>`;
        renderTable([]);
        if(labelEl){
          labelEl.textContent = activeTab === "ratu" ? "Model: smanji ratu" : "Model: skrati rok";
        }
        return;
      }

      renderSummary(res, allocationCurrent, activeTab);
      renderTable(res.rows);

      if(labelEl){
        labelEl.textContent = activeTab === "ratu" ? "Model: smanji ratu" : "Model: skrati rok";
      }
    }

    // -----------------------
    // Glavna kalk funkcija
    // -----------------------
    function recalc(){
      const principal = parseFloat(document.getElementById("principal").value);
      const rate = parseFloat(document.getElementById("rate").value);
      const years = parseFloat(document.getElementById("years").value);
      const type = document.getElementById("type").value;
      const allocation = parseFloat(document.getElementById("allocation").value);

      allocationCurrent = allocation;

      if(
        isNaN(principal) || principal<=0 ||
        isNaN(rate) || rate<0 ||
        isNaN(years) || years<=0 ||
        isNaN(allocation) || allocation<0
      ){
        lastResultRatu = null;
        lastResultRok = null;
        renderUI();
        return;
      }

      lastResultRatu = generateScheduleReducePayment(principal, rate, years, type, allocation);
      lastResultRok  = generateScheduleShortenTerm(principal, rate, years, type, allocation);

      renderUI();
    }

    // -----------------------
    // Eventi
    // -----------------------
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("calcForm");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        recalc();
      });

      // tabovi
      document.querySelectorAll(".tab-button").forEach(btn => {
        btn.addEventListener("click", () => {
          activeTab = btn.getAttribute("data-tab");

          // aktivna klasa
          document.querySelectorAll(".tab-button").forEach(b => {
            b.classList.toggle("active", b === btn);
          });

          renderUI();
        });
      });

      // inicijalni primjer s default vrijednostima
      recalc();
    });
  </script>
</body>
</html>
